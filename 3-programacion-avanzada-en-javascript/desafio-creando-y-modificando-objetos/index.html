<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Desafío creando y modificando objetos</title>
</head>

<body>

  <script>
    /* 
    Requerimientos
    
    1. Crear todo el código usando ES5.
    */

    /* 
    2. Crear una función constructora para cada objeto.
    */
    //Función constructora del objeto Paciente
    function Consultorio(nombre, pacientes) {
      //recibimos los parametro en variables
      this.nombre = nombre;
      this.pacientes = pacientes || [];

    }

    //Función constructora del objeto Paciente
    function Paciente(nombre, edad, rut, diagnostico) {
      let _nombre = nombre;
      let _edad = edad;
      let _rut = rut;
      let _diagnostico = diagnostico;

      //Definiendo getters
      Object.defineProperty(this, "_getNombre", {
        get: function () {
          return _nombre
        }
      });

      Object.defineProperty(this, "_getEdad", {
        get: function () {
          return _edad
        }
      });

      Object.defineProperty(this, "_getRut", {
        get: function () {
          return _rut
        }
      });

      Object.defineProperty(this, "_getDiagnostico", {
        get: function () {
          return _diagnostico
        }
      });

      //Definiendo setters
      Object.defineProperty(this, "_setNombre", {
        set: function (nombre) {
          return _nombre = nombre;
        }
      });

      Object.defineProperty(this, "_setEdad", {
        set: function (edad) {
          return _edad = edad;
        }
      });

      Object.defineProperty(this, "_setRut", {
        set: function (rut) {
          return _rut = rut;
        }
      });

      Object.defineProperty(this, "_setDiagnostico", {
        set: function (diagnostico) {
          return _diagnostico = diagnostico;
        }
      });
    }

    /* 
    3. Implementar métodos getters y setters para poder acceder y modificar los datos de
    los pacientes.
    */

    //Getters
    Paciente.prototype.getNombre = function () {
      return this._getNombre;
    }

    Paciente.prototype.getEdad = function () {
      return this._getEdad;
    }

    Paciente.prototype.getRut = function () {
      return this._getRut;
    }

    Paciente.prototype.getDiagnostico = function () {
      return this._getDiagnostico;
    }

    //Setters

    Paciente.prototype.setNombre = function (nombre) {
      return this._setNombre = nombre;
    }

    Paciente.prototype.setEdad = function (edad) {
      return this._setEdad = edad;
    }

    Paciente.prototype.setRut = function (rut) {
      return this._setRut = rut;
    }

    Paciente.prototype.setDiagnostico = function (rut) {
      return this._setDiagnostico = rut;
    }

    /* 
    4. Crear un método mediante la propiedad prototype que permita buscar los datos de
    los usuarios por nombre y otro método que permita mostrar todos los datos de los
    usuarios registrados.
    */

    //método que busca los datos de los usuarios por nombre
    Consultorio.prototype.buscarPaciente = function (nombre) {
      let paciente = this.pacientes.find(paciente => paciente.getNombre() === nombre);
      if (paciente) return ({
        nombre: paciente.getNombre(), 
        edad: paciente.getEdad(),
        rut: paciente.getRut(),
        diagnostico: paciente.getDiagnostico()
      });

      return `El paciente ${nombre} no existe en el consultorio ${this.nombre}`;
    }

    Consultorio.prototype.mostrarPacientes = function () {
      let pacientes = this.pacientes.map(element => ({
        nombre: element.getNombre(), 
        edad: element.getEdad(),
        rut: element.getRut(),
        diagnostico: element.getDiagnostico()
      }));

      return pacientes;
    }

    /* 
    5. Instanciar cada objeto utilizando la instrucción new.
    */

    let p1 = new Paciente("Gustavo Romero", "31", "17690848-3", "positivo");
    let p2 = new Paciente("Raúl Farias", "31", "18365433-k", "negativo");
    let consultorio = new Consultorio("soa Bachelé", [p1,p2]);


    //Accediendo a los valores con getters
    console.log(p1.getNombre());
    console.log(p1.getEdad());
    console.log(p1.getRut());
    console.log(p1.getDiagnostico());

    //Actualizando los valores con getter
    p1.setNombre("Tavo Romero");
    p1.setEdad("25");
    p1.setRut("1111111-1");
    p1.setDiagnostico("negativo")

    //Obteniendo pacientes por nombre con la función buscarPaciente
    console.log(consultorio.buscarPaciente("Tavo Romero"));
    console.log(consultorio.buscarPaciente("Raúl Farias"));
    console.log(consultorio.buscarPaciente("Obi-Wan Kenobi"));
    console.log(consultorio.mostrarPacientes());

  </script>
</body>

</html>